# Quest Map 機能要件定義書

**バージョン**: 1.0  
**最終更新**: 2025/01/29  
**作成者**: こう

---

## 1. プロダクト概要

### 1.1 背景

探究学習において、多くの生徒が「やりたいことはあるが動けない」「調べたけど次が見えない」という課題を抱えている。現状の探Qメイトは「思考整理」に価値があるが、それだけでは行動に繋がらない。

### 1.2 ビジョン

「学ぶって楽しい！」と思いながら豊かに生きていける社会。

### 1.3 ミッション

豊かなインタラクティブ体験で、探究学習を「自分の興味に基づいて自ら動き続けられる」体験へ変える。

### 1.4 検証する仮説

> **問い**: どうすれば生徒は探究学習で行動を起こすか  
> **仮説**: 「これはやってみたい！面白そう！」に出会えば行動できる

### 1.5 プロダクトコンセプト

Quest Mapは、生徒の「現在地」から「ゴール」までの道筋を可視化し、**選択肢の提示**と**ロードマップの提示**によって行動を促すノードベースのマップUI。

---

## 2. ターゲットユーザー

### 2.1 プライマリペルソナ

**「やること決めたけど止まる」生徒**

- 興味あるテーマを持っている
- 「どうやって進めるか」のHowがわからない
- 選択肢が見えれば動ける可能性が高い

### 2.2 セカンダリペルソナ

**「調べたけど次が見えない」生徒**

- 情報を得ても「で、ここからどうすれば？」となる
- ロードマップがあれば次のステップに進める

---

## 3. 機能要件（MVP）

### 3.1 コア機能

| ID | 機能 | 説明 | 優先度 |
|----|------|------|--------|
| F-001 | ゴール・現状入力 | ユーザーがゴールと現状を入力する | 必須 |
| F-002 | 選択肢の生成 | AIが次の行動選択肢を複数提示する | 必須 |
| F-003 | ロードマップの表示 | 選択肢→その先→ゴールまでの道筋を可視化 | 必須 |
| F-004 | ノードクリック→詳細表示 | クリックで詳細情報とサブメニューを表示 | 必須 |
| F-005 | 細分化 | 選択肢をより小さいステップに分解 | 必須 |
| F-006 | 拡散 | 同じ階層に別の選択肢を追加 | 必須 |
| F-007 | 完了→現状更新 | 完了時に現状を更新し、次の選択肢を再生成 | 必須 |
| F-008 | 推奨のハイライト | AIが推奨する選択肢をハイライト表示 | 必須 |
| F-009 | AIに相談・質問 | ノードに関してAIに質問できる | 必須 |

### 3.2 v2以降の機能

| ID | 機能 | 説明 |
|----|------|------|
| F-101 | 対話遺伝的アルゴリズム | 生徒のリアクションから最適な選択肢を学習 |
| F-102 | 履歴の詳細表示 | 通ってきた道の振り返り |
| F-103 | ノードのドラッグ&ドロップ | 手動でマップを編集 |

---

## 4. 画面構成

### 4.1 入力画面

**目的**: ゴールと現状を入力し、マップを生成する

**構成要素**:
- タイトル「🗺️ クエストを設定」
- ゴール入力欄
- 現状入力欄
- 生成ボタン「選択肢を生成する ✨」

**状態（States）**:
| State | 説明 |
|-------|------|
| Empty | 初期状態、入力欄が空 |
| Filled | ゴールと現状が入力済み |
| Loading | 送信後、選択肢生成中 |

---

### 4.2 マップ画面

**目的**: 現在地からゴールまでのロードマップを可視化

**構成要素**:
- 現在地ノード（左）
- 選択肢ノード（中央）
- 未来ノード（右）
- ゴールノード（右端）
- 矢印（実線：次のアクション、点線：その先）
- 凡例

**状態（States）**:
| State | 説明 |
|-------|------|
| Initial | マップが表示された初期状態 |
| Node Selected | ノードをクリック、サブメニュー表示 |
| Completing | 完了処理中 |
| Completed | 完了モーダル表示 |
| Breakdown Loading | 細分化生成中 |
| Breakdown Done | 細分化ノードが追加された状態 |
| Expand Loading | 拡散生成中 |
| Expand Done | 新しい選択肢が追加された状態 |
| AI Chat Open | AIに相談のチャットが開いた状態 |

---

### 4.3 サブメニュー（Overlay）

**目的**: ノードに対するアクションを選択

**構成要素**:
- 「💬 AIに相談・質問」ボタン
- 「🔍 細分化」ボタン
- 「🌐 拡散」ボタン
- 「✅ 完了する」ボタン
- 閉じるボタン

---

### 4.4 完了モーダル（Overlay）

**目的**: 完了時に現状を更新

**構成要素**:
- タイトル「やってみてどうだった？」
- テキストエリア（現状更新用）
- AIからのコメント表示エリア
- 「完了する」ボタン

---

### 4.5 詳細パネル（Overlay）

**目的**: ノードの詳細情報を表示

**構成要素**:
- アイコン + タイトル
- カテゴリタグ
- 説明文
- 所要時間（目安）
- 難易度（任意）
- アクションボタン

---

## 5. ノード仕様

### 5.1 ノードの種類

| 種類 | 形状 | 色 | 用途 |
|------|------|-----|------|
| Current | 角丸長方形 | 緑グラデーション | 現在地を示す |
| Goal | 角丸長方形 | オレンジグラデーション | ゴールを示す |
| Action | 白カード | 白背景 + カテゴリ色 | 選択肢を示す |
| Future | 白カード（薄） | 白背景 + opacity 0.5 | その先のステップを示す |
| Completed | 白カード（グレー） | グレー背景 | 完了済みを示す |

### 5.2 Action Node 構成

```
┌──────────────────────┐
│ [○] タイトル         │  ← アイコン（丸背景）+ タイトル横並び
│                      │
│ [カテゴリ]           │  ← 左下にタグ
└──────────────────────┘
```

**サイズ**: 160 × auto px  
**Padding**: 12px 14px  
**角丸**: 12px  
**Shadow**: 0 1px 3px rgba(0,0,0,0.08)

### 5.3 カテゴリ

| カテゴリ | アイコン | 背景色 | テキスト色 |
|---------|---------|--------|-----------|
| 調べる | 🔍 | #E8F6F5 | #0D7377 |
| 考える | 💭 | #FFF9E6 | #8B6914 |
| 聞く | 🎤 | #F3EEFF | #5B21B6 |
| 作る | 📝 | #FDF2F8 | #9D174D |
| データ | 📊 | #ECFDF5 | #047857 |

### 5.4 ノードの状態（Variants）

| State | 説明 | 見た目 |
|-------|------|--------|
| Default | 通常状態 | 白背景 |
| Hover | ホバー時 | translateY(-2px) + shadow強化 |
| Recommended | 推奨 | オレンジ枠線 + バッジ「おすすめ」 |
| Completed | 完了済み | グレー背景 + ✓バッジ |
| Future | その先 | opacity 0.5 |

---

## 6. 矢印仕様

### 6.1 矢印の種類

| 種類 | 線種 | 色 | 用途 |
|------|------|-----|------|
| Solid | 実線 | #FF8C5A | 次のアクション（現在地→選択肢） |
| Dashed | 点線 | #9A928A | その先のステップ（選択肢→未来→ゴール） |

### 6.2 矢印の設定

- 線幅: 2.5px（Solid）/ 2px（Dashed）
- Dash: 6px, 4px
- 形状: 曲線（Bezier）
- 矢印: 終点に三角形

---

## 7. インタラクション仕様

### 7.1 基本フロー

```
入力画面
    │
    │ [生成ボタン]
    ▼
マップ画面（初期）
    │
    │ [ノードクリック]
    ▼
サブメニュー表示
    │
    ├─[AIに相談]──→ チャットパネル
    │
    ├─[細分化]────→ 細分化ノード追加（縦方向）
    │
    ├─[拡散]──────→ 選択肢追加（横方向）
    │
    └─[完了する]──→ 完了モーダル
                        │
                        │ [完了ボタン]
                        ▼
                    現在地移動 + 次の選択肢更新
```

### 7.2 細分化フロー

1. ノードをクリック
2. サブメニュー「細分化」を選択
3. ローディング表示
4. 選択したノードの**手前**に、より小さいステップのノードが**縦方向**に追加

### 7.3 拡散フロー

1. ノードをクリック
2. サブメニュー「拡散」を選択
3. ローディング表示
4. **同じ階層**に別の選択肢ノードが追加

### 7.4 完了フロー

1. ノードをクリック
2. サブメニュー「完了する」を選択
3. 完了モーダル表示
4. 「やってみてどうだった？」を入力
5. AIからのコメント表示
6. 「完了する」ボタンで確定
7. 現在地が移動
8. 新しい現状に基づいて次の選択肢が更新（推奨ハイライト付き）

---

## 8. データモデル

### 8.1 Quest（クエスト）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | 一意のID |
| goal | string | ゴール |
| currentStatus | string | 現在の状態 |
| createdAt | timestamp | 作成日時 |
| updatedAt | timestamp | 更新日時 |

### 8.2 Node（ノード）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | 一意のID |
| questId | string | 所属するクエストのID |
| type | enum | current / goal / action / future |
| title | string | タイトル |
| description | string | 説明文 |
| category | enum | 調べる / 考える / 聞く / 作る / データ |
| status | enum | default / recommended / completed |
| position | object | { x: number, y: number } |
| parentId | string | 親ノードのID（細分化の場合） |
| createdAt | timestamp | 作成日時 |

### 8.3 Edge（矢印）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | 一意のID |
| questId | string | 所属するクエストのID |
| sourceId | string | 始点ノードのID |
| targetId | string | 終点ノードのID |
| type | enum | solid / dashed |

### 8.4 History（履歴）

| フィールド | 型 | 説明 |
|-----------|-----|------|
| id | string | 一意のID |
| questId | string | 所属するクエストのID |
| nodeId | string | 完了したノードのID |
| feedback | string | 完了時の入力内容 |
| completedAt | timestamp | 完了日時 |

---

## 9. AI連携仕様

### 9.1 選択肢生成

**入力**:
- ゴール
- 現状
- （任意）過去の行動履歴

**出力**:
- 3〜5個の選択肢
- 各選択肢にカテゴリ、タイトル、説明、推奨フラグ

### 9.2 細分化

**入力**:
- 対象ノードの情報
- コンテキスト（ゴール、現状）

**出力**:
- 2〜4個の小さいステップ

### 9.3 拡散

**入力**:
- 対象ノードの情報
- 既存の選択肢
- コンテキスト（ゴール、現状）

**出力**:
- 2〜3個の代替選択肢

### 9.4 推奨判定

**入力**:
- 全選択肢
- 現状
- （任意）生徒の傾向データ

**出力**:
- 推奨する選択肢のID

---

## 10. 非機能要件

### 10.1 パフォーマンス

- 選択肢生成: 3秒以内
- 細分化・拡散: 2秒以内
- マップ描画: 1秒以内

### 10.2 対応環境

- PC（Chrome, Safari, Firefox, Edge）
- 画面幅: 1280px以上を想定

### 10.3 アクセシビリティ

- キーボード操作対応
- 色のコントラスト比 4.5:1以上

---

## 11. 今後の検討事項

- [ ] ゴールなしルートの設計
- [ ] 複数クエストの管理
- [ ] 先生向け管理画面
- [ ] 対話遺伝的アルゴリズムの詳細設計
-