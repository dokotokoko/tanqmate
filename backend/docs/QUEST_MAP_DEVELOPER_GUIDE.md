# æ¢Qãƒãƒƒãƒ—æ©Ÿèƒ½ é–‹ç™ºè€…ã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡
1. [æ¦‚è¦](#æ¦‚è¦)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
4. [APIä»•æ§˜](#apiä»•æ§˜)
5. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…)
6. [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
7. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)
8. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹)
9. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
10. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

## æ¦‚è¦

æ¢Qãƒãƒƒãƒ—ã¯ã€ç›®æ¨™é”æˆã®ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªèª²é¡Œåˆ†è§£ãƒ»é€²æ—ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¨­å®šã—ãŸç›®æ¨™ã‚’è¦–è¦šçš„ãªãƒãƒƒãƒ—ä¸Šã§ç®¡ç†ã—ã€AIã«ã‚ˆã‚‹æ”¯æ´æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½
- ğŸ¯ **ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†**: ç›®æ¨™è¨­å®šã¨é€²æ—è¿½è·¡
- ğŸ—‚ï¸ **ãƒãƒ¼ãƒ‰æ“ä½œ**: ã‚¿ã‚¹ã‚¯ã®ä½œæˆãƒ»ç·¨é›†ãƒ»å®Œäº†ç®¡ç†
- ğŸ¤– **AIæ”¯æ´**: è‡ªå‹•ãƒãƒ¼ãƒ‰ç”Ÿæˆãƒ»åˆ†è§£ãƒ»æ‹¡æ•£
- ğŸ“Š **è¦–è¦šåŒ–**: D3.jsã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒãƒƒãƒ—
- âš¡ **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°**: WebSocketã«ã‚ˆã‚‹åŒæ™‚ç·¨é›†
- ğŸ”— **çµ±åˆæ©Ÿèƒ½**: ã‚¯ã‚¨ã‚¹ãƒˆã‚«ãƒ¼ãƒ‰ã¨ã®é€£æº

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React App     â”‚    â”‚   FastAPI       â”‚    â”‚   Database      â”‚
â”‚   (Frontend)    â”‚â—„â”€â”€â–ºâ”‚   (Backend)     â”‚â—„â”€â”€â–ºâ”‚   (PostgreSQL)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ QuestMap UI   â”‚    â”‚ â€¢ REST API      â”‚    â”‚ â€¢ Quest Maps    â”‚
â”‚ â€¢ D3.js Canvas  â”‚    â”‚ â€¢ AI Integrationâ”‚    â”‚ â€¢ Nodes/Edges   â”‚
â”‚ â€¢ Zustand Store â”‚    â”‚ â€¢ WebSocket     â”‚    â”‚ â€¢ User Data     â”‚
â”‚ â€¢ Error Handler â”‚    â”‚ â€¢ Cache Layer   â”‚    â”‚ â€¢ History       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                        â”‚                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AI Services   â”‚
                    â”‚   (OpenAI)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
backend/
â”œâ”€â”€ routers/
â”‚   â””â”€â”€ quest_map.py          # APIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ quest_map_service.py  # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ quest_map_ai.py       # AIçµ±åˆ
â”‚   â””â”€â”€ quest_map_realtime.py # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½
â”œâ”€â”€ models/
â”‚   â””â”€â”€ quest_map.py          # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ schemas/
â”‚   â””â”€â”€ quest_map.py          # Pydanticã‚¹ã‚­ãƒ¼ãƒ
â””â”€â”€ tests/
    â””â”€â”€ test_quest_map.py     # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
```
src/components/QuestMap/
â”œâ”€â”€ QuestMapEnhanced.tsx      # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ QuestMapCanvas.tsx        # D3.jsæç”»
â”œâ”€â”€ QuestMapNode.tsx          # ãƒãƒ¼ãƒ‰è¡¨ç¤º
â”œâ”€â”€ QuestMapOptimized.tsx     # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç‰ˆ
â”œâ”€â”€ QuestMapLazy.tsx          # Lazy loading
â”œâ”€â”€ __tests__/               # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ animations/              # ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ
```sql
-- ã‚¯ã‚¨ã‚¹ãƒˆãƒ¡ã‚¤ãƒ³
quest_map_quests (
  id: BIGSERIAL PRIMARY KEY,
  user_id: BIGINT NOT NULL,
  goal: TEXT NOT NULL,
  current_status: VARCHAR(50),
  created_at: TIMESTAMP,
  updated_at: TIMESTAMP
)

-- ãƒãƒ¼ãƒ‰
quest_map_nodes (
  id: BIGSERIAL PRIMARY KEY,
  quest_id: BIGINT NOT NULL,
  type: VARCHAR(50) NOT NULL,
  title: VARCHAR(500) NOT NULL,
  description: TEXT,
  status: VARCHAR(50),
  position_x: INTEGER,
  position_y: INTEGER,
  parent_id: BIGINT,
  metadata: JSONB,
  created_at: TIMESTAMP,
  updated_at: TIMESTAMP
)

-- ã‚¨ãƒƒã‚¸ï¼ˆé–¢é€£æ€§ï¼‰
quest_map_edges (
  id: BIGSERIAL PRIMARY KEY,
  quest_id: BIGINT NOT NULL,
  source_id: BIGINT NOT NULL,
  target_id: BIGINT NOT NULL,
  type: VARCHAR(50) NOT NULL,
  weight: INTEGER,
  metadata: JSONB,
  created_at: TIMESTAMP
)

-- æ“ä½œå±¥æ­´
quest_map_history (
  id: BIGSERIAL PRIMARY KEY,
  quest_id: BIGINT NOT NULL,
  node_id: BIGINT,
  action_type: VARCHAR(100) NOT NULL,
  feedback: TEXT,
  metadata: JSONB,
  completed_at: TIMESTAMP,
  created_at: TIMESTAMP
)
```

## é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶
- Python 3.10+
- Node.js 18+
- PostgreSQL 14+
- Redis 7+ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# Pythonä»®æƒ³ç’°å¢ƒä½œæˆ
python -m venv venv
source venv/bin/activate  # Windowsã®å ´åˆ: venv\Scripts\activate

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±ç­‰ã‚’è¨­å®š

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
python -c "
from models.quest_map import QuestMapModel
sql_statements = QuestMapModel.create_all_tables_sql()
print('\n'.join(sql_statements))
" | psql -d your_database

# ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
cd react-app
npm install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
npm run dev

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test

# E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test:e2e
```

### Docker ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# Docker Compose ã§å…¨ä½“èµ·å‹•
docker-compose up -d

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ã¿èµ·å‹•
docker-compose up -d backend
docker-compose up -d frontend
```

## APIä»•æ§˜

### èªè¨¼
ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯Bearer Tokenèªè¨¼ãŒå¿…è¦ã§ã™ã€‚

```javascript
const response = await fetch('/api/quest-map/quests', {
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  }
})
```

### ä¸»è¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### 1. ã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ
```http
POST /api/quest-map/quests
Content-Type: application/json

{
  "goal": "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹",
  "initial_context": "ç¾åœ¨PythonåŸºç¤ã‚’å­¦ç¿’ä¸­"
}
```

#### 2. ã‚¯ã‚¨ã‚¹ãƒˆã‚°ãƒ©ãƒ•å–å¾—
```http
GET /api/quest-map/quests/1/graph

Response:
{
  "quest": {...},
  "nodes": [...],
  "edges": [...],
  "statistics": {...}
}
```

#### 3. AI ãƒãƒ¼ãƒ‰ç”Ÿæˆ
```http
POST /api/quest-map/nodes/generate
Content-Type: application/json

{
  "quest_id": 1,
  "context": "Pythonå­¦ç¿’ã®å…·ä½“çš„ã‚¹ãƒ†ãƒƒãƒ—",
  "node_count": 5
}
```

è©³ç´°ãªAPIä»•æ§˜ã¯ [OpenAPIä»•æ§˜æ›¸](./backend/docs/quest_map_api.yaml) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

### çŠ¶æ…‹ç®¡ç† (Zustand)
```typescript
// stores/questMapStore.ts
interface QuestMapState {
  currentQuest: Quest | null
  nodes: QuestNode[]
  edges: QuestEdge[]
  selectedNode: QuestNode | null
  isLoading: boolean
  error: string | null
  
  // Actions
  createQuest: (data: QuestCreateRequest) => Promise<void>
  loadQuestGraph: (questId: number) => Promise<void>
  selectNode: (node: QuestNode) => void
  updateNode: (node: QuestNode) => void
  // ...
}

const useQuestMapStore = create<QuestMapState>((set, get) => ({
  // å®Ÿè£…...
}))
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ç”¨ä¾‹
```tsx
// QuestMapãƒšãƒ¼ã‚¸ã§ã®ä½¿ç”¨
import { QuestMapLazy } from '@/components/QuestMap'

const QuestMapPage = () => {
  const questId = useParams().questId

  return (
    <QuestMapLazy
      questId={Number(questId)}
      activeTab="map"
      enablePreload={true}
    />
  )
}
```

### D3.jsçµ±åˆ
```typescript
// D3.jsã‚’ä½¿ã£ãŸæç”»ä¾‹
const drawNodes = (svg: d3.Selection, nodes: QuestNode[]) => {
  const nodeGroup = svg.selectAll('.node')
    .data(nodes, d => d.id)

  nodeGroup.enter()
    .append('g')
    .attr('class', 'node')
    .attr('transform', d => `translate(${d.position.x},${d.position.y})`)
    .call(drag()) // ãƒ‰ãƒ©ãƒƒã‚°æ©Ÿèƒ½è¿½åŠ 
    .on('click', handleNodeClick)
    .on('dblclick', handleNodeComplete)

  // ãƒãƒ¼ãƒ‰ã®æç”»æ›´æ–°
  nodeGroup
    .select('circle')
    .attr('r', d => getNodeRadius(d.type))
    .attr('fill', d => getNodeColor(d.status))
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```tsx
// React.memoã‚’ä½¿ã£ãŸæœ€é©åŒ–
const OptimizedQuestMapNode = memo<NodeProps>(({
  node,
  isSelected,
  onSelect,
  onUpdate,
  scale
}) => {
  return (
    <QuestMapNode
      node={node}
      isSelected={isSelected}
      onSelect={onSelect}
      onUpdate={onUpdate}
      scale={scale}
    />
  )
}, (prevProps, nextProps) => {
  // ã‚«ã‚¹ã‚¿ãƒ æ¯”è¼ƒé–¢æ•°
  return (
    prevProps.node.id === nextProps.node.id &&
    prevProps.node.status === nextProps.node.status &&
    prevProps.isSelected === nextProps.isSelected &&
    prevProps.scale === nextProps.scale
  )
})
```

## ãƒ†ã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
# å˜ä½“ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cd backend
pytest tests/test_quest_map.py -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬
pytest tests/ --cov=. --cov-report=html

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
pytest tests/test_quest_map.py::TestQuestMapAPI::test_create_quest -v
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
```bash
# å˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆ
npm run test

# ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬
npm run test:coverage

# UI ãƒ†ã‚¹ãƒˆ
npm run test:ui

# E2Eãƒ†ã‚¹ãƒˆ
npm run test:e2e

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npm run test -- QuestMapCanvas.test.tsx
```

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```python
# conftest.py ã§ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æº–å‚™
@pytest.fixture
def sample_quest_data():
    return {
        "goal": "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹",
        "initial_context": "PythonåŸºç¤å­¦ç¿’ä¸­"
    }

@pytest.fixture
def sample_nodes():
    return [
        {
            "type": "goal",
            "title": "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ãƒã‚¹ã‚¿ãƒ¼",
            "position": {"x": 0, "y": 0}
        },
        # ...
    ]
```

## ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### ç’°å¢ƒè¨­å®š
```bash
# æœ¬ç•ªç’°å¢ƒå¤‰æ•°ä¾‹
export DATABASE_URL="postgresql://user:pass@db:5432/tanqmates"
export REDIS_URL="redis://redis:6379/0"
export OPENAI_API_KEY="sk-..."
export ENVIRONMENT="production"
export SECRET_KEY="your-secret-key"
```

### Docker ãƒ‡ãƒ—ãƒ­ã‚¤
```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    ports:
      - "8000:8000"
    depends_on:
      - db
      - redis

  frontend:
    build:
      context: ./react-app
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend

  db:
    image: postgres:14
    environment:
      POSTGRES_DB: tanqmates
      POSTGRES_USER: ${DB_USER}
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
    ports:
      - "6379:6379"

volumes:
  postgres_data:
```

### CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```yaml
# .github/workflows/deploy.yml
name: Deploy Quest Map
on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
      - name: Backend Tests
        run: |
          cd backend
          pip install -r requirements.txt
          pytest tests/ -v
      
      # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ
      - name: Frontend Tests
        run: |
          cd react-app
          npm ci
          npm run test:coverage
          npm run test:e2e
  
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Production
        run: |
          docker-compose -f docker-compose.prod.yml up -d --build
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ

#### 1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æœ€é©åŒ–
- **React.memo**: ä¸è¦ãªå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é˜²æ­¢
- **useMemo/useCallback**: è¨ˆç®—çµæœãƒ»é–¢æ•°ã®ãƒ¡ãƒ¢åŒ–
- **ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«**: å¤§é‡ãƒãƒ¼ãƒ‰ã®åŠ¹ç‡çš„è¡¨ç¤º
- **ã‚³ãƒ¼ãƒ‰åˆ†å‰²**: Lazy loading ã«ã‚ˆã‚‹åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“çŸ­ç¸®

#### 2. APIæœ€é©åŒ–
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥**: Redis + ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ»ã‚¯ã‚¨ãƒªãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- **åœ§ç¸®**: gzip ãƒ¬ã‚¹ãƒãƒ³ã‚¹åœ§ç¸®

#### 3. D3.jsæœ€é©åŒ–
```typescript
// åŠ¹ç‡çš„ãªD3.jsæ›´æ–°
const updateNodes = (nodes: QuestNode[]) => {
  // enter/update/exitãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä½¿ç”¨
  const nodeUpdate = svg.selectAll('.node')
    .data(nodes, d => d.id)

  // æ–°è¦è¦ç´ 
  const nodeEnter = nodeUpdate.enter()
    .append('g')
    .attr('class', 'node')

  // æ—¢å­˜è¦ç´ ã®æ›´æ–°
  nodeUpdate.merge(nodeEnter)
    .transition()
    .duration(300)
    .attr('transform', d => `translate(${d.position.x},${d.position.y})`)

  // å‰Šé™¤è¦ç´ 
  nodeUpdate.exit()
    .transition()
    .duration(300)
    .style('opacity', 0)
    .remove()
}
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
const measurePerformance = (operation: string, fn: () => void) => {
  const start = performance.now()
  fn()
  const end = performance.now()
  console.log(`${operation}: ${end - start}ms`)
}

// ä½¿ç”¨ä¾‹
measurePerformance('Node Rendering', () => {
  renderNodes(visibleNodes)
})
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### 1. èªè¨¼ãƒ»èªå¯
```python
# JWTèªè¨¼ã®å®Ÿè£…ä¾‹
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer

security = HTTPBearer()

async def get_current_user(token: str = Depends(security)):
    try:
        payload = jwt.decode(token.credentials, SECRET_KEY, algorithms=['HS256'])
        user_id = payload.get('user_id')
        if user_id is None:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="Invalid token"
            )
        return user_id
    except jwt.ExpiredSignatureError:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Token expired"
        )
```

### 2. å…¥åŠ›æ¤œè¨¼
```python
# Pydanticã«ã‚ˆã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
from pydantic import BaseModel, validator

class QuestCreateRequest(BaseModel):
    goal: str
    initial_context: Optional[str] = None
    
    @validator('goal')
    def validate_goal(cls, v):
        if not v or len(v.strip()) == 0:
            raise ValueError('Goal is required')
        if len(v) > 1000:
            raise ValueError('Goal too long')
        return v.strip()
```

### 3. SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–
```python
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã‚¯ã‚¨ãƒªã®ä½¿ç”¨
async def get_quest(quest_id: int, user_id: int):
    query = """
        SELECT * FROM quest_map_quests 
        WHERE id = %s AND user_id = %s
    """
    result = await database.fetch_one(query, [quest_id, user_id])
    return result
```

### 4. ãƒ¬ãƒ¼ãƒˆåˆ¶é™
```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.post("/api/quest-map/nodes/generate")
@limiter.limit("10/minute")  # AIæ©Ÿèƒ½ã¯åˆ¶é™ã‚’å³ã—ã
async def generate_nodes(request: Request, ...):
    # å®Ÿè£…
```

### 5. CORSè¨­å®š
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://tanqmates.com"],  # æœ¬ç•ªç’°å¢ƒã§ã¯å…·ä½“çš„ãªãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒ‡å®š
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. D3.jsæç”»ãŒè¡¨ç¤ºã•ã‚Œãªã„
**ç—‡çŠ¶**: QuestMapã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç©ºç™½ã§è¡¨ç¤ºã•ã‚Œã‚‹
**åŸå› **: SVGè¦ç´ ã®ã‚µã‚¤ã‚ºãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„

```typescript
// è§£æ±ºæ–¹æ³•
useEffect(() => {
  if (containerRef.current) {
    const rect = containerRef.current.getBoundingClientRect()
    setSvgDimensions({ width: rect.width, height: rect.height })
  }
}, [])
```

#### 2. APIã‚¨ãƒ©ãƒ¼: 401 Unauthorized
**ç—‡çŠ¶**: ã™ã¹ã¦ã®APIå‘¼ã³å‡ºã—ãŒèªè¨¼ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
**åŸå› **: ãƒˆãƒ¼ã‚¯ãƒ³ã®æœŸé™åˆ‡ã‚Œã¾ãŸã¯ä¸æ­£ãªãƒˆãƒ¼ã‚¯ãƒ³

```typescript
// è§£æ±ºæ–¹æ³•: ãƒˆãƒ¼ã‚¯ãƒ³ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
const handleApiCall = async () => {
  try {
    return await apiCall()
  } catch (error) {
    if (error.status === 401) {
      await refreshToken()
      return await apiCall() // å†è©¦è¡Œ
    }
    throw error
  }
}
```

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ: å¤§é‡ãƒãƒ¼ãƒ‰ã§é‡ã„
**ç—‡çŠ¶**: 100å€‹ä»¥ä¸Šã®ãƒãƒ¼ãƒ‰ã§æç”»ãŒé…ã„
**è§£æ±ºæ–¹æ³•**: ä»®æƒ³åŒ–ã¨ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®å®Ÿè£…

```typescript
// è¡¨ç¤ºé ˜åŸŸã®ãƒãƒ¼ãƒ‰ã®ã¿æç”»
const visibleNodes = useMemo(() => {
  return nodes.filter(node => {
    const { x, y } = node.position
    return (
      x >= viewport.x - margin &&
      x <= viewport.x + viewport.width + margin &&
      y >= viewport.y - margin &&
      y <= viewport.y + viewport.height + margin
    )
  })
}, [nodes, viewport])
```

#### 4. WebSocketæ¥ç¶šã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãŒå‹•ä½œã—ãªã„
**åŸå› **: WebSocketæ¥ç¶šã®è¨­å®šã‚„ãƒ—ãƒ­ã‚­ã‚·ã®å•é¡Œ

```typescript
// è§£æ±ºæ–¹æ³•: æ¥ç¶šã®å†è©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
const connectWebSocket = () => {
  const ws = new WebSocket(wsUrl)
  
  ws.onopen = () => {
    console.log('WebSocket connected')
    setConnectionStatus('connected')
    retryCount = 0
  }
  
  ws.onclose = () => {
    console.log('WebSocket disconnected')
    setConnectionStatus('disconnected')
    
    // è‡ªå‹•å†æ¥ç¶šï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
    if (retryCount < MAX_RETRIES) {
      setTimeout(() => {
        connectWebSocket()
        retryCount++
      }, Math.pow(2, retryCount) * 1000)
    }
  }
  
  return ws
}
```

#### 5. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯
**ç—‡çŠ¶**: é•·æ™‚é–“ä½¿ç”¨ã§ãƒ–ãƒ©ã‚¦ã‚¶ã®å‹•ä½œãŒé‡ããªã‚‹
**åŸå› **: ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚„ã‚¿ã‚¤ãƒãƒ¼ã®é©åˆ‡ãªæ¸…ç†ä¸è¶³

```typescript
// è§£æ±ºæ–¹æ³•: useEffectã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
useEffect(() => {
  const timer = setInterval(updateData, 1000)
  
  return () => {
    clearInterval(timer) // å¿˜ã‚Œãšã«ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  }
}, [])

useEffect(() => {
  const handleResize = () => updateViewport()
  window.addEventListener('resize', handleResize)
  
  return () => {
    window.removeEventListener('resize', handleResize)
  }
}, [])
```

### ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«

#### 1. é–‹ç™ºãƒ„ãƒ¼ãƒ«
```typescript
// é–‹ç™ºç’°å¢ƒã§ã®ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
if (process.env.NODE_ENV === 'development') {
  console.log('Quest Map Debug Info:', {
    nodeCount: nodes.length,
    edgeCount: edges.length,
    selectedNode: selectedNode?.id,
    renderTime: performance.now() - startTime
  })
}
```

#### 2. ã‚¨ãƒ©ãƒ¼ç›£è¦–
```typescript
// Sentryãªã©ã®ã‚¨ãƒ©ãƒ¼ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹çµ±åˆ
import * as Sentry from '@sentry/react'

Sentry.init({
  dsn: process.env.REACT_APP_SENTRY_DSN,
  environment: process.env.NODE_ENV,
})

// ã‚¨ãƒ©ãƒ¼å¢ƒç•Œã§ã®ã‚¨ãƒ©ãƒ¼é€ä¿¡
componentDidCatch(error: Error, errorInfo: ErrorInfo) {
  Sentry.captureException(error, {
    contexts: {
      react: {
        componentStack: errorInfo.componentStack,
      },
    },
  })
}
```

### ãƒ­ã‚°è¨­å®š
```python
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°è¨­å®š
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('quest_map.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

# ä½¿ç”¨ä¾‹
@router.post("/quests")
async def create_quest(request: QuestCreateRequest):
    logger.info(f"Creating quest: {request.goal}")
    try:
        result = await service.create_quest(request)
        logger.info(f"Quest created successfully: {result.id}")
        return result
    except Exception as e:
        logger.error(f"Failed to create quest: {e}")
        raise
```

---

ã“ã®ã‚¬ã‚¤ãƒ‰ã¯æ¢Qãƒãƒƒãƒ—æ©Ÿèƒ½ã®é–‹ç™ºãƒ»é‹ç”¨ã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªæƒ…å ±ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚
è³ªå•ã‚„å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€GitHub Issues ã¾ãŸã¯Slack ã® #quest-map ãƒãƒ£ãƒ³ãƒãƒ«ã§ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚